<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¯¸ì…˜ ë ˆì´ë“œ</title>
  <meta name="description" content="7ê°œì˜ ë¯¸ì…˜ ì¹´ë“œ ì¤‘ 3ì¥ì„ ë½‘ìŒ (1ë²ˆ ì¹´ë“œëŠ” í•­ìƒ í¬í•¨)" />
  <style>
    :root{
      --bg: #0f172a;          /* slate-900 */
      --panel: #0b1022;       /* deep navy */
      --ink: #e2e8f0;         /* slate-200 */
      --muted: #94a3b8;       /* slate-400 */
      --accent: #22c55e;      /* emerald-500 */
      --accent-2: #38bdf8;    /* sky-400 */
      --danger: #ef4444;      /* red-500 */
      --card: #111827;        /* gray-900 */
      --card-face: #111827;
      --card-back: linear-gradient(135deg,#1f2937 0%,#0b1022 50%,#1f2937 100%);
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1000px 500px at 50% -20%,#1f2937 0%,#0f172a 50%,#0b1022 100%);
      color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", "ë§‘ì€ ê³ ë”•", "Nanum Gothic", sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(1100px,100%);}
    header{display:flex; gap:12px; align-items:flex-end; justify-content:space-between; margin-bottom:16px}
    .title{font-size:clamp(22px,4vw,36px); font-weight:800; letter-spacing:.3px}
    .subtitle{color:var(--muted); font-size:14px}

    .panel{background:rgba(255,255,255,.03); border:1px solid rgba(148,163,184,.2); border-radius:var(--radius); box-shadow:var(--shadow);}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; padding:14px; align-items:center; justify-content:space-between}
    .btn{appearance:none; border:1px solid rgba(148,163,184,.35); background:#0b1328; color:#e5e7eb; padding:10px 14px; border-radius:14px; font-weight:700; letter-spacing:.2px; cursor:pointer; transition:transform .05s ease, background .2s ease, border-color .2s ease}
    .btn:hover{transform:translateY(-1px); background:#0f1a3b}
    .btn.primary{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#16a34a}
    .btn.primary:hover{background:linear-gradient(180deg,#22c55e,#16a34a)}
    .btn.ghost{background:transparent}

    .deck-area{display:grid; grid-template-columns: 1fr; gap:16px; padding:16px}
    .area{border-top:1px solid rgba(148,163,184,.18); padding-top:12px}

    .cards{display:grid; grid-template-columns: repeat(3, minmax(0,1fr)); gap:16px}
    @media (max-width: 860px){ .cards{grid-template-columns:1fr} }

    .card{perspective:1000px; position:relative; height:220px}
    .card-inner{position:absolute; inset:0; transform-style:preserve-3d; transition: transform .9s cubic-bezier(.2,.7,.2,1)}
    .card.revealed .card-inner{ transform: rotateY(180deg) }

    .face{ position:absolute; inset:0; backface-visibility:hidden; border-radius:16px; overflow:hidden; }
    .face.back{ background:var(--card-back); display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,.1)}
    .back .pattern{
      width:68%; height:68%; border-radius:12px; background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,.12), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(255,255,255,.08), transparent 40%),
        linear-gradient(45deg, rgba(56,189,248,.3), rgba(34,197,94,.25));
      border:1px solid rgba(255,255,255,.2);
      display:flex; align-items:center; justify-content:center; font-weight:900; letter-spacing:1px;
      text-transform:uppercase; color:#e5e7eb;
    }
    .face.front{ transform: rotateY(180deg); background:var(--card-face); border:1px solid rgba(255,255,255,.1); display:flex; flex-direction:column; padding:16px }
    .badge{font-size:12px; color:#93c5fd; letter-spacing:.4px}
    .num{margin-top:8px; font-weight:900; font-size:20px; background:linear-gradient(90deg,#38bdf8,#22c55e); -webkit-background-clip:text; background-clip:text; color:transparent}
    .mission{margin-top:8px; font-weight:700; font-size:16px; line-height:1.4}
    .note{margin-top:auto; font-size:12px; color:var(--muted)}

    .deck{height:220px; display:grid; place-items:center; position:relative}
    .deck-stack{
      position:absolute; width:180px; height:240px;
      transform: translateY(-6px);
    }
    .deck-card{
      position:absolute; inset:0; border-radius:16px; background:var(--card-back); border:1px solid rgba(255,255,255,.12);
      transform: translate(var(--tx,0), var(--ty,0)) rotate(var(--rot,0deg));
      animation: float 3s ease-in-out infinite;
      box-shadow: var(--shadow);
    }
    .deck-card:nth-child(2){ --tx: 4px; --ty: -4px; --rot: -3deg }
    .deck-card:nth-child(3){ --tx: -6px; --ty: 6px; --rot: 5deg }
    @keyframes float{ 0%,100%{ transform: translate(var(--tx,0), var(--ty,0)) rotate(var(--rot,0deg)) } 50%{ transform: translate(calc(var(--tx,0) + 0px), calc(var(--ty,0) - 8px)) rotate(calc(var(--rot,0deg) + .2deg)) } }

    .hint{color:var(--muted); font-size:13px; margin-top:4px}

    .toast{ position:fixed; inset:auto 50% 24px auto; transform:translateX(-50%); background:#0b1328; color:#e5e7eb; padding:10px 14px; border-radius:12px; border:1px solid rgba(148,163,184,.35); box-shadow:var(--shadow); opacity:0; pointer-events:none }
    .toast.show{ opacity:1; animation: toast 2.2s ease forwards }
    @keyframes toast{ 0%{opacity:0; transform:translate(-50%,6px)} 10%,85%{opacity:1; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,-4px)} }

    .confetti{ position:fixed; inset:0; pointer-events:none }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">ë¯¸ì…˜ ë ˆì´ë“œ</div>
        <div class="subtitle">7ê°œì˜ ë¯¸ì…˜ ì¤‘ <b>3ì¥</b>ì„ ë½‘ìŒ. (<b>1ë²ˆ ë¯¸ì…˜</b>ì€ í•­ìƒ í¬í•¨)</div>
      </div>
    </header>

    <section class="panel">
      <div class="toolbar">
        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button class="btn primary" id="drawBtn">ğŸ² 3ì¥ ë½‘ê¸°</button>
          <button class="btn ghost" id="revealBtn" disabled>ğŸƒ ìˆœì„œëŒ€ë¡œ ê³µê°œ</button>
          <button class="btn" id="resetBtn">ì´ˆê¸°í™”</button>
        </div>
      </div>

      <div class="deck-area">
        <div class="deck">
          <div class="deck-stack" id="deckStack" aria-label="ì¹´ë“œ ë”ë¯¸">
            <div class="deck-card"></div>
            <div class="deck-card"></div>
            <div class="deck-card"></div>
          </div>
        </div>

        <div class="area">
          <div class="cards" id="cards"></div>
        </div>
      </div>
    </section>
  </div>

  <canvas class="confetti" id="fx"></canvas>
  <div class="toast" id="toast">ì¹´ë“œë¥¼ ì…”í”Œí–ˆìŠµë‹ˆë‹¤!</div>

  <script>
    // ===== ë°ì´í„°: 7ê°œ ë¯¸ì…˜ =====
    const MISSIONS = [
      {num:1, text:"ê²Œì„ ë‚˜ê°€ê¸°ë¥¼ ì œì™¸ í•œ ë¬´ìŠ¨ ìˆ˜ë¥¼ ì¨ì„œë¼ë„ ë ˆì´ë“œ ì‹¤íŒ¨í•˜ê¸°"},
      {num:2, text:"ë‚´ë¶€(ë¸”ë™ì„œíë²„ìŠ¤ ë¸Œë ˆì´í¬ ê¸°ë¯¹)ì— ë‹¨ í•œ ë²ˆë„ ì°¸ì—¬í•˜ì§€ ì•Šê³  ë ˆì´ë“œ ì„±ê³µí•˜ê¸°"},
      {num:3, text:"í˜¼ì 3ë²ˆ ì´ìƒ ì£½ê³  ë ˆì´ë“œ ì„±ê³µí•˜ê¸°"},
      {num:4, text:"í€µìŠ¬ë¡¯ì„ ì „ë¶€ ë¹„ìš°ê³  ë‹¨ í•œ ë²ˆë„ ì£½ì§€ ì•Šê³  ë ˆì´ë“œ ì„±ê³µí•˜ê¸°", note:"(ì „íˆ¬ ì‹œì‘/í›„ ìŠ¤ìƒ· í•„ìˆ˜)"},
      {num:5, text:"17ì´ˆë¥¼ ë§ì¶°ì„œ ë ˆì´ë“œ ì„±ê³µ ë° ì¢…ë£Œ", note:"(ë§ˆì§€ë§‰ í´ë¦¬ì–´ íƒ€ì„ ê¸°ì¤€)"},
      {num:6, text:"ë‚˜ë¨¸ì§€ ë‘ ëª…ì´ ë¯¸ì…˜ ì‹¤íŒ¨í•˜ê¸°"},
      {num:7, text:"ë§ˆì§€ë§‰ì— ì£½ì€ ìƒíƒœë¡œ ë ˆì´ë“œ í´ë¦¬ì–´í•˜ê¸°"},
    ];

    // ìœ í‹¸: ì„ê¸°
    const shuffle = (arr) => {
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    };

    // 3ì¥ ë½‘ê¸° (1ë²ˆ ì¹´ë“œ ë°˜ë“œì‹œ í¬í•¨)
    function drawThreeWithOneGuaranteed(){
      const rest = [2,3,4,5,6,7];
      const pick = shuffle(rest).slice(0,2); // 2ì¥ ë½‘ê³ 
      pick.push(1); // 1ë²ˆ ì¶”ê°€
      return shuffle(pick); // ìˆœì„œ ì„ê¸°
    }

    // DOM ì°¸ì¡°
    const cardsEl = document.getElementById('cards');
    const drawBtn = document.getElementById('drawBtn');
    const revealBtn = document.getElementById('revealBtn');
    const resetBtn = document.getElementById('resetBtn');
    const toast = document.getElementById('toast');

    let drawn = []; // ë½‘íŒ ì¹´ë“œ ë²ˆí˜¸ ë°°ì—´
    let revealIndex = 0; // ê³µê°œ ì§„í–‰ ì¸ë±ìŠ¤

    // ì¹´ë“œ ì—˜ë¦¬ë¨¼íŠ¸ ìƒì„±
    function createCard(){
      const wrap = document.createElement('div');
      wrap.className = 'card';
      wrap.innerHTML = `
        <div class="card-inner">
          <div class="face back"><div class="pattern">MISSION</div></div>
          <div class="face front">
            <div class="badge">ë¯¸ì…˜ ì¹´ë“œ</div>
            <div class="num">NO.<span class="no">?</span></div>
            <div class="mission">...</div>
            <div class="note"></div>
          </div>
        </div>`;
      return wrap;
    }

    function showToast(msg){
      toast.textContent = msg; toast.classList.remove('show');
      void toast.offsetWidth; // reflow
      toast.classList.add('show');
    }

    // ê°„ë‹¨í•œ ì»¨í˜í‹° íš¨ê³¼
    function confettiBurst(){
      const cvs = document.getElementById('fx');
      const ctx = cvs.getContext('2d');
      const w = cvs.width = window.innerWidth;
      const h = cvs.height = window.innerHeight;
      const pieces = Array.from({length: 120}, () => ({
        x: Math.random()*w,
        y: -10 - Math.random()*h*0.3,
        vy: 1 + Math.random()*3,
        vx: -1 + Math.random()*2,
        s: 2 + Math.random()*4,
        r: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
        color: `hsl(${Math.random()*360},90%,60%)`
      }));
      let life = 90; // frames
      function tick(){
        ctx.clearRect(0,0,w,h);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.r += p.vr;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r);
          ctx.fillStyle = p.color; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);
          ctx.restore();
        });
        if(life-->0) requestAnimationFrame(tick); else ctx.clearRect(0,0,w,h);
      }
      tick();
    }

    // ë½‘ê¸°
    drawBtn.addEventListener('click', () => {
      // ì´ˆê¸°í™”
      cardsEl.innerHTML = '';
      revealIndex = 0;
      drawn = drawThreeWithOneGuaranteed();

      // 3ì¥ì˜ ìë¦¬ ìƒì„± + ë±ì—ì„œ ë‚ ì•„ì˜¤ëŠ” ì• ë‹ˆë©”ì´ì…˜
      drawn.forEach((n, i) => {
        const el = createCard();
        el.style.opacity = 0; el.style.transform = 'translateY(10px)';
        cardsEl.appendChild(el);
        setTimeout(()=>{
          el.style.transition = 'transform .5s ease, opacity .5s ease';
          el.style.opacity = 1; el.style.transform = 'translateY(0)';
        }, 180*i);
      });

      // ë± í”ë“¤ë¦¼ ëŠë‚Œ
      const deck = document.getElementById('deckStack');
      deck.animate([
        { transform:'translateY(0) rotate(0deg)' },
        { transform:'translateY(2px) rotate(1deg)' },
        { transform:'translateY(-2px) rotate(-1deg)' },
        { transform:'translateY(0) rotate(0deg)' }
      ], { duration: 480, easing:'ease-in-out' });

      showToast('ì¹´ë“œë¥¼ ì…”í”Œí–ˆìŠµë‹ˆë‹¤! (1ë²ˆ ì¹´ë“œ í¬í•¨ ë³´ì¥)');
      revealBtn.disabled = false;
    });

    // ìˆœì„œëŒ€ë¡œ ê³µê°œ (í”Œë¦½)
    revealBtn.addEventListener('click', () => {
      const nodes = [...cardsEl.children];
      if (revealIndex >= nodes.length) return;
      const wrap = nodes[revealIndex];
      const inner = wrap.querySelector('.card-inner');
      const no = wrap.querySelector('.no');
      const mission = wrap.querySelector('.mission');
      const note = wrap.querySelector('.note');

      const cardNum = drawn[revealIndex];
      const info = MISSIONS.find(m=>m.num===cardNum);
      no.textContent = info.num;
      mission.textContent = info.text;
      note.textContent = info.note || '';

      wrap.classList.add('revealed');
      revealIndex++;

      if (revealIndex === 3){
        confettiBurst();
        revealBtn.disabled = true;
        showToast('ëª¨ë“  ì¹´ë“œê°€ ê³µê°œë˜ì—ˆìŠµë‹ˆë‹¤!');
      }
    });

    // ì´ˆê¸°í™”
    resetBtn.addEventListener('click', () => {
      cardsEl.innerHTML = '';
      revealIndex = 0; drawn = [];
      revealBtn.disabled = true;
      showToast('ì´ˆê¸°í™” ì™„ë£Œ');
    });
  </script>
</body>
</html>

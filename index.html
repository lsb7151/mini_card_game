<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ÎØ∏ÏÖò Î†àÏù¥Îìú</title>
  <meta name="description" content="Î¥ÑÎπÑÍ∏∏Îìú Ïù¥Î≤§Ìä∏Ïö© Ïπ¥ÎìúÎΩëÍ∏∞ ÏïÑÎ¨¥ÎèÑ ÎÇ¥ Í≥†ÏÉùÏùÄ Î™∞ÎùºÏ£ºÏßÄ" />
  <style>
    :root{
      --bg: #0f172a;          /* slate-900 */
      --panel: #0b1022;       /* deep navy */
      --ink: #e2e8f0;         /* slate-200 */
      --muted: #94a3b8;       /* slate-400 */
      --accent: #22c55e;      /* emerald-500 */
      --accent-2: #38bdf8;    /* sky-400 */
      --danger: #ef4444;      /* red-500 */
      --card: #111827;        /* gray-900 */
      --card-face: #111827;
      --card-back: linear-gradient(135deg,#1f2937 0%,#0b1022 50%,#1f2937 100%);
      --radius: 18px;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background: radial-gradient(1000px 500px at 50% -20%,#1f2937 0%,#0f172a 50%,#0b1022 100%);
      color:var(--ink); font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", "Malgun Gothic", "ÎßëÏùÄ Í≥†Îîï", "Nanum Gothic", sans-serif;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .app{width:min(1200px,100%);}
    header{display:flex; gap:12px; align-items:flex-end; justify-content:space-between; margin-bottom:16px}
    .title{font-size:clamp(22px,4vw,36px); font-weight:800; letter-spacing:.3px}
    .subtitle{color:var(--muted); font-size:14px}

    .panel{background:rgba(255,255,255,.03); border:1px solid rgba(148,163,184,.2); border-radius:var(--radius); box-shadow:var(--shadow);}
    .toolbar{display:flex; gap:10px; flex-wrap:wrap; padding:14px; align-items:center; justify-content:space-between}
    .btn{appearance:none; border:1px solid rgba(148,163,184,.35); background:#0b1328; color:#e5e7eb; padding:10px 14px; border-radius:14px; font-weight:700; letter-spacing:.2px; cursor:pointer; transition:transform .05s ease, background .2s ease, border-color .2s ease}
    .btn:hover{transform:translateY(-1px); background:#0f1a3b}
    .btn.primary{background:linear-gradient(180deg,#16a34a,#15803d); border-color:#16a34a}
    .btn.primary:hover{background:linear-gradient(180deg,#22c55e,#16a34a)}
    .btn.ghost{background:transparent}
    .btn.warn{background:linear-gradient(180deg,#ef4444,#b91c1c); border-color:#ef4444}

    .segmented{display:flex; gap:6px; padding:6px; background:#0b1328; border:1px solid rgba(148,163,184,.25); border-radius:14px}
    .segmented button{border:none; background:transparent; color:#e5e7eb; padding:8px 12px; border-radius:10px; font-weight:700; cursor:pointer}
    .segmented button.active{background:#1f2a52}

    .deck-area{display:grid; grid-template-columns: 1fr; gap:16px; padding:16px}
    .area{border-top:1px solid rgba(148,163,184,.18); padding-top:12px}

    .cards{display:grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap:16px}

    .card{perspective:1000px; position:relative; height:220px}
    .card-inner{position:absolute; inset:0; transform-style:preserve-3d; transition: transform .9s cubic-bezier(.2,.7,.2,1)}
    .card.revealed .card-inner{ transform: rotateY(180deg) }

    .face{ position:absolute; inset:0; backface-visibility:hidden; border-radius:16px; overflow:hidden; }
    .face.back{ background:var(--card-back); display:flex; align-items:center; justify-content:center; border:1px solid rgba(255,255,255,.1)}
    .back .pattern{
      width:68%; height:68%; border-radius:12px; background:
        radial-gradient(circle at 20% 20%, rgba(255,255,255,.12), transparent 40%),
        radial-gradient(circle at 80% 80%, rgba(255,255,255,.08), transparent 40%),
        linear-gradient(45deg, rgba(56,189,248,.3), rgba(34,197,94,.25));
      border:1px solid rgba(255,255,255,.2);
      display:flex; align-items:center; justify-content:center; font-weight:900; letter-spacing:1px;
      text-transform:uppercase; color:#e5e7eb;
    }
    .face.front{ transform: rotateY(180deg); background:var(--card-face); border:1px solid rgba(255,255,255,.1); display:flex; flex-direction:column; padding:16px }
    .badge{font-size:12px; color:#93c5fd; letter-spacing:.4px}
    .num{margin-top:8px; font-weight:900; font-size:20px; background:linear-gradient(90deg,#38bdf8,#22c55e); -webkit-background-clip:text; background-clip:text; color:transparent}
    .mission{margin-top:8px; font-weight:700; font-size:16px; line-height:1.4}
    .note{margin-top:auto; font-size:12px; color:var(--muted)}

    .deck{height:220px; display:grid; place-items:center; position:relative}
    .deck-stack{
      position:absolute; width:180px; height:240px;
      transform: translateY(-6px);
    }
    .deck-card{
      position:absolute; inset:0; border-radius:16px; background:var(--card-back); border:1px solid rgba(255,255,255,.12);
      transform: translate(var(--tx,0), var(--ty,0)) rotate(var(--rot,0deg));
      animation: float 3s ease-in-out infinite;
      box-shadow: var(--shadow);
    }
    .deck-card:nth-child(2){ --tx: 4px; --ty: -4px; --rot: -3deg }
    .deck-card:nth-child(3){ --tx: -6px; --ty: 6px; --rot: 5deg }
    @keyframes float{ 0%,100%{ transform: translate(var(--tx,0), var(--ty,0)) rotate(var(--rot,0deg)) } 50%{ transform: translate(calc(var(--tx,0) + 0px), calc(var(--ty,0) - 8px)) rotate(calc(var(--rot,0deg) + .2deg)) } }

    .hint{color:var(--muted); font-size:13px; margin-top:4px}

    .toast{ position:fixed; inset:auto 50% 24px auto; transform:translateX(-50%); background:#0b1328; color:#e5e7eb; padding:10px 14px; border-radius:12px; border:1px solid rgba(148,163,184,.35); box-shadow:var(--shadow); opacity:0; pointer-events:none }
    .toast.show{ opacity:1; animation: toast 2.2s ease forwards }
    @keyframes toast{ 0%{opacity:0; transform:translate(-50%,6px)} 10%,85%{opacity:1; transform:translate(-50%,0)} 100%{opacity:0; transform:translate(-50%,-4px)} }

    .confetti{ position:fixed; inset:0; pointer-events:none }

    .modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(0,0,0,.55); z-index:50 }
    .modal.show{ display:flex }
    .modal-card{ width:min(800px,92%); background:#0b1328; color:#e5e7eb; border:1px solid rgba(148,163,184,.28); border-radius:16px; box-shadow:var(--shadow); }
    .modal-head{ display:flex; align-items:center; justify-content:space-between; padding:14px 16px; border-bottom:1px solid rgba(148,163,184,.2)}
    .modal-body{ max-height:70vh; overflow:auto; padding:16px }
    .modal-close{ border:none; background:#111827; color:#e5e7eb; border-radius:10px; padding:8px 12px; cursor:pointer }
    .mission-list{ margin:0; padding-left:20px }
    .mission-list li{ margin:6px 0 }
    .mode-meta{ color:var(--muted); font-size:12px; margin-left:8px }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div>
        <div class="title">ÎØ∏ÏÖò Î†àÏù¥Îìú</div>
        <div id="subtitle" class="subtitle">Î†àÏù¥ÎìúÎ•º ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.</div>
      </div>
    </header>

    <section class="panel">
      <div class="toolbar">

        <div class="segmented" role="tablist" aria-label="Î†àÏù¥Îìú ÏÑ†ÌÉù">
          <button id="modeSuccubus" class="active" role="tab" aria-selected="true">ÏÑúÌÅêÎ≤ÑÏä§</button>
          <button id="modeGeulgi" role="tab" aria-selected="false">Í∏ÄÍ∏∞ Ïñ¥Î†§ÏõÄ</button>
        </div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center">
          <button class="btn primary" id="drawBtn">üé≤ ÎΩëÍ∏∞</button>
          <button class="btn ghost" id="revealBtn" disabled>üÉè ÏàúÏÑúÎåÄÎ°ú Í≥µÍ∞ú</button>
          <button class="btn" id="viewAllBtn">ÎØ∏ÏÖò Ï†ÑÏ≤¥Î≥¥Í∏∞</button>
          <button class="btn" id="resetBtn">Ï¥àÍ∏∞Ìôî</button>
        </div>
      </div>

      <div class="deck-area">
        <div class="deck">
          <div class="deck-stack" id="deckStack" aria-label="Ïπ¥Îìú ÎçîÎØ∏">
            <div class="deck-card"></div>
            <div class="deck-card"></div>
            <div class="deck-card"></div>
          </div>
        </div>

        <div class="area">
          <div class="cards" id="cards"></div>
        </div>
      </div>
    </section>
  </div>


  <div class="modal" id="modal">
    <div class="modal-card">
      <div class="modal-head">
        <div>
          <strong id="modalTitle">ÎØ∏ÏÖò Ï†ÑÏ≤¥Î≥¥Í∏∞</strong>
          <span id="modalMeta" class="mode-meta"></span>
        </div>
        <button class="modal-close" id="modalClose">Îã´Í∏∞</button>
      </div>
      <div class="modal-body">
        <ol id="missionList" class="mission-list"></ol>
      </div>
    </div>
  </div>

  <canvas class="confetti" id="fx"></canvas>
  <div class="toast" id="toast">Ïπ¥ÎìúÎ•º ÏÖîÌîåÌñàÏäµÎãàÎã§!</div>

  <script>

    const GAMES = {
      succubus: {
        name: "ÏÑúÌÅêÎ≤ÑÏä§",
        draw: 3,
        missions: [
          {num:1, text:"Í≤åÏûÑ ÎÇòÍ∞ÄÍ∏∞Î•º Ï†úÏô∏ Ìïú Î¨¥Ïä® ÏàòÎ•º Ïç®ÏÑúÎùºÎèÑ Î†àÏù¥Îìú Ïã§Ìå®ÌïòÍ∏∞"},
          {num:2, text:"ÎÇ¥Î∂Ä(Î∏îÎûôÏÑúÌÅêÎ≤ÑÏä§ Î∏åÎ†àÏù¥ÌÅ¨ Í∏∞ÎØπ)Ïóê Îã® ÌïúÎ≤àÎèÑ Ï∞∏Ïó¨ÌïòÏßÄÏïäÍ≥† Î†àÏù¥Îìú ÏÑ±Í≥µÌïòÍ∏∞"},
          {num:3, text:"ÌòºÏûê 3Î≤àÏù¥ÏÉÅ Ï£ΩÍ≥† Î†àÏù¥Îìú ÏÑ±Í≥µÌïòÍ∏∞"},
          {num:4, text:"ÌÄµÏä¨Î°ØÏùÑ Ï†ÑÎ∂Ä ÎπÑÏö∞Í≥† Îã®ÌïúÎ≤àÎèÑ Ï£ΩÏßÄÏïäÍ≥† Î†àÏù¥Îìú ÏÑ±Í≥µÌïòÍ∏∞", note:"(Ï†ÑÌà¨ ÏãúÏûë, Ï†ÑÌà¨ ÌõÑ Ïä§ÏÉ∑ ÌïÑÏöî)"},
          {num:5, text:"17Ï¥àÎ•º ÎßûÏ∂∞ÏÑú Î†àÏù¥Îìú ÏÑ±Í≥µ Î∞è Ï¢ÖÎ£å", note:"(ÎßàÏßÄÎßâ ÌÅ¥Î¶¨Ïñ¥ÌÉÄÏûÑ ÌëúÍ∏∞Î•º Í∏∞Ï§ÄÏúºÎ°ú Ìï©ÎãàÎã§)"},
          {num:6, text:"ÎÇòÎ®∏ÏßÄ ÎëêÎ™ÖÏù¥ ÎØ∏ÏÖò Ïã§Ìå®ÌïòÍ∏∞"},
          {num:7, text:"ÎßàÏßÄÎßâÏóê Ï£ΩÏùÄÏÉÅÌÉúÎ°ú Î†àÏù¥Îìú ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞"},
          {num:8, text:"Î∞©Ïñ¥Íµ¨Î•º Î™®Îëê ÏûÖÏßÄÏïäÍ≥† ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞"}
        ]
      },
      geulgi: {
        name: "Í∏ÄÍ∏∞ Ïñ¥Î†§ÏõÄ",
        draw: 7,
        missions: [
          {num:1, text:"Í≤åÏûÑ ÎÇòÍ∞ÄÍ∏∞Î•º Ï†úÏô∏ Ìïú Î¨¥Ïä® ÏàòÎ•º Ïç®ÏÑúÎùºÎèÑ Î†àÏù¥Îìú Ïã§Ìå®ÌïòÍ∏∞", note:"(Ï°∞Î†•ÏûêÍ∞Ä ÏûàÏùÑÏàòÎèÑ ÏûàÏäµÎãàÎã§)"},
          {num:2, text:"ÌòºÏûê 3Î≤àÏù¥ÏÉÅ Ï£ΩÍ≥† Î†àÏù¥Îìú ÏÑ±Í≥µÌïòÍ∏∞"},
          {num:3, text:"Î∞©Ïñ¥Íµ¨Î•º Î™®Îëê ÏûÖÏßÄÏïäÍ≥† ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞", note:"(ÏïÑÏù¥ÌÖú Î∂ÑÌï¥ÎÇò ÌåêÎß§Î•º Ï°∞Ïã¨ÌïòÏÑ∏Ïöî! Ïû†Í∑∏Í≥† Ï∞©Ïö©Ìï¥Ï†ú!)"},
          {num:4, text:"17Ï¥àÎ•º ÎßûÏ∂∞ÏÑú Î†àÏù¥Îìú ÏÑ±Í≥µ Î∞è Ï¢ÖÎ£å", note:"(ÎßàÏßÄÎßâ ÌÅ¥Î¶¨Ïñ¥ÌÉÄÏûÑ ÌëúÍ∏∞Î•º Í∏∞Ï§ÄÏúºÎ°ú Ìï©ÎãàÎã§)"},
          {num:5, text:"ÎÇòÎ®∏ÏßÄÏù∏ÏõêÏ§ë 5Î™ÖÏù¥ÏÉÅ ÎØ∏ÏÖò Ïã§Ìå®ÌïòÍ∏∞"},
          {num:6, text:"ÎßàÏßÄÎßâÏóê Ï£ΩÏùÄÏÉÅÌÉúÎ°ú Î†àÏù¥Îìú ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞"},
          {num:7, text:"Ïö¥ÎèÑ Ïã§Î†•. Ïñ¥ÎñªÍ≤åÎì† ÌÅ¥Î¶¨Ïñ¥Îßå ÌïòÍ∏∞"},
          {num:8, text:"ÌååÍ¥¥ÎêòÎäî ÏßÄÌòïÏóêÏÑú ÎÇôÏÇ¨ ÎëêÎ≤àÏù¥ÏÉÅÌïòÍ≥† ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞"},
          {num:9, text:"ÌÄµÏä¨Î°ØÏùÑ Ï†ÑÎ∂Ä ÎπÑÏö∞Í≥† Îã®ÌïúÎ≤àÎèÑ Ï£ΩÏßÄÏïäÍ≥† Î†àÏù¥Îìú ÏÑ±Í≥µÌïòÍ∏∞", note:"(Ï†ÑÌà¨ ÏãúÏûë, Ï†ÑÌà¨ ÌõÑ Ïä§ÏÉ∑ ÌïÑÏöî)"},
          {num:10, text:"Î≥¥Ïä§ Ï†ÑÌà¨Ï§ëÏóê ÌååÌã∞Ï±ÑÌåÖÏúºÎ°ú Ï±ÑÌåÖ 17Ìöå ÌïòÍ∏∞"},
          {num:11, text:"(Î†àÏù¥Îìú Ïã§Ìå®ÌïòÍ∏∞ ÎØ∏ÏÖòÏùÑ Í∞ÄÏßÑÏÇ¨ÎûåÏù¥ ÌïúÎ™ÖÏûàÏäµÎãàÎã§ ÎπÑÎ∞ÄÎ°ú Ìï¥Ï£ºÏÑ∏Ïöî) Ìï¥Îãπ ÎØ∏ÏÖòÏùÑ Í∞ÄÏßÑÏÇ¨ÎûåÏóêÍ≤å Îì§ÌÇ§ÏßÄ ÏïäÍ≥† ÎèÑÏôÄÏÑú Î†àÏù¥Îìú Ïã§Ìå®ÌïòÍ∏∞", note:"- Î†àÏù¥Îìú Ïã§Ìå®ÌïòÍ∏∞ ÎØ∏ÏÖòÏùÑ Î∞õÏùÄÏÇ¨ÎûåÏùÄ Ï°∞Î†•ÏûêÎ•º ÎßûÏ∂îÎäî ÎØ∏ÏÖòÏù¥ Îî∞Î°ú ÏûàÏäµÎãàÎã§. Îì§ÌÇ§ÏßÄ ÎßàÏÑ∏Ïöî."},
          {num:12, text:"ÏïÖÏÑ∏Î•º ÌïòÎÇòÎèÑ Ï∞©Ïö©ÌïòÏßÄÏïäÍ≥† ÌÅ¥Î¶¨Ïñ¥ÌïòÍ∏∞", note:"(ÏïÑÏù¥ÌÖú Î∂ÑÌï¥ÎÇò ÌåêÎß§Î•º Ï°∞Ïã¨ÌïòÏÑ∏Ïöî! Ïû†Í∑∏Í≥† Ï∞©Ïö©Ìï¥Ï†ú!)"},
          {num:13, text:"ÏßÑÏßú ÏïÑÏù¥ÎîîÏñ¥Í∞Ä ÏóÜÎã§ Ïù¥Ï†† Îîú 3Îì±ÏïàÏóê Îì§Í∏∞"}
        ]
      }
    };


    const shuffle = (arr) => {
      const a = [...arr];
      for(let i=a.length-1;i>0;i--){
        const j = Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
      return a;
    };

    function drawWithOneGuaranteed(totalMissions, drawCount) {
      // 1Î≤à ÌïÑÏàò Ìè¨Ìï®
      const restNums = totalMissions.filter(m => m.num !== 1).map(m => m.num);
      const picked = shuffle(restNums).slice(0, drawCount - 1);
      picked.push(1);
      return shuffle(picked);
    }


    const cardsEl = document.getElementById('cards');
    const drawBtn = document.getElementById('drawBtn');
    const revealBtn = document.getElementById('revealBtn');
    const resetBtn = document.getElementById('resetBtn');
    const viewAllBtn = document.getElementById('viewAllBtn');
    const toast = document.getElementById('toast');
    const subtitle = document.getElementById('subtitle');

    const modeSuccubus = document.getElementById('modeSuccubus');
    const modeGeulgi = document.getElementById('modeGeulgi');


    const modal = document.getElementById('modal');
    const modalClose = document.getElementById('modalClose');
    const modalTitle = document.getElementById('modalTitle');
    const modalMeta = document.getElementById('modalMeta');
    const missionList = document.getElementById('missionList');


    let currentMode = 'succubus'; // 'succubus' | 'geulgi'
    let drawn = [];           
    let autoRevealing = false;

    function updateSubtitleAndButtons() {
      const game = GAMES[currentMode];
      subtitle.innerHTML = `${game.name}: <b>${game.missions.length}</b>Í∞ú Ï§ë <b>${game.draw}</b>Ïû• ÎΩëÍ∏∞ (1Î≤à ÌïÑÏàò)`;
      drawBtn.textContent = `üé≤ ${game.draw}Ïû• ÎΩëÍ∏∞`;
    }

    function activateMode(mode) {
      currentMode = mode;
      modeSuccubus.classList.toggle('active', mode === 'succubus');
      modeGeulgi.classList.toggle('active', mode === 'geulgi');
      modeSuccubus.setAttribute('aria-selected', mode === 'succubus');
      modeGeulgi.setAttribute('aria-selected', mode === 'geulgi');
      updateSubtitleAndButtons();

      cardsEl.innerHTML = '';
      drawn = [];
      autoRevealing = false;
      revealBtn.disabled = true;
      showToast(`${GAMES[mode].name}`);
    }


    function showToast(msg){
      toast.textContent = msg; toast.classList.remove('show');
      void toast.offsetWidth;
      toast.classList.add('show');
    }

    function confettiBurst(){
      const cvs = document.getElementById('fx');
      const ctx = cvs.getContext('2d');
      const w = cvs.width = window.innerWidth;
      const h = cvs.height = window.innerHeight;
      const pieces = Array.from({length: 140}, () => ({
        x: Math.random()*w,
        y: -10 - Math.random()*h*0.3,
        vy: 1 + Math.random()*3,
        vx: -1 + Math.random()*2,
        s: 2 + Math.random()*4,
        r: Math.random()*Math.PI,
        vr: -0.2 + Math.random()*0.4,
        color: `hsl(${Math.random()*360},90%,60%)`
      }));
      let life = 90;
      function tick(){
        ctx.clearRect(0,0,w,h);
        pieces.forEach(p=>{
          p.x += p.vx; p.y += p.vy; p.r += p.vr;
          ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.r);
          ctx.fillStyle = p.color; ctx.fillRect(-p.s/2,-p.s/2,p.s,p.s);
          ctx.restore();
        });
        if(life-->0) requestAnimationFrame(tick); else ctx.clearRect(0,0,w,h);
      }
      tick();
    }


    function createCard(){
      const wrap = document.createElement('div');
      wrap.className = 'card';
      wrap.innerHTML = `
        <div class="card-inner">
          <div class="face back"><div class="pattern">MISSION</div></div>
          <div class="face front">
            <div class="badge">ÎØ∏ÏÖò Ïπ¥Îìú</div>
            <div class="num">NO.<span class="no">?</span></div>
            <div class="mission">...</div>
            <div class="note"></div>
          </div>
        </div>`;
      return wrap;
    }

    function revealCardAt(index){
      const nodes = [...cardsEl.children];
      const wrap = nodes[index];
      if (!wrap || wrap.classList.contains('revealed')) return;

      const no = wrap.querySelector('.no');
      const mission = wrap.querySelector('.mission');
      const note = wrap.querySelector('.note');

      const cardNum = drawn[index];
      const info = GAMES[currentMode].missions.find(m=>m.num===cardNum);
      no.textContent = info.num;
      mission.textContent = info.text;
      note.textContent = info.note || '';

      wrap.classList.add('revealed');

      if (nodes.every(n => n.classList.contains('revealed'))) {
        revealBtn.disabled = true;
        confettiBurst();
        showToast('Î™®Îì† Ïπ¥ÎìúÍ∞Ä Í≥µÍ∞úÎêòÏóàÏäµÎãàÎã§!');
      }
    }

    function revealInOrder(){
      if (autoRevealing) return;
      autoRevealing = true;

      const nodes = [...cardsEl.children];
      let i = 0;
      function step(){
        if (i >= nodes.length) {
          autoRevealing = false;
          return;
        }
        revealCardAt(i++);
        setTimeout(step, 500);
      }
      step();
    }

    modeSuccubus.addEventListener('click', ()=>activateMode('succubus'));
    modeGeulgi.addEventListener('click', ()=>activateMode('geulgi'));

    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') modal.classList.remove('show');
    });

    viewAllBtn.addEventListener('click', ()=>{
      const game = GAMES[currentMode];
      missionList.innerHTML = '';
      game.missions.forEach(m=>{
        const li = document.createElement('li');
        li.innerHTML = `<strong>${m.num}.</strong> ${m.text}${m.note ? ` <span style="color:#94a3b8">${m.note}</span>` : ''}`;
        missionList.appendChild(li);
      });
      modalTitle.textContent = 'ÎØ∏ÏÖò Ï†ÑÏ≤¥Î≥¥Í∏∞';
      modalMeta.textContent = `¬∑ ${game.name} ¬∑ ${game.missions.length}Í∞ú Ï§ë ${game.draw}Ïû• ÎΩëÍ∏∞ ¬∑ 1Î≤à ÌïÑÏàò`;
      modal.classList.add('show');
    });
    modalClose.addEventListener('click', ()=>modal.classList.remove('show'));
    modal.addEventListener('click', (e)=>{ if (e.target === modal) modal.classList.remove('show'); });


    drawBtn.addEventListener('click', () => {
      const game = GAMES[currentMode];


      cardsEl.innerHTML = '';
      drawn = drawWithOneGuaranteed(game.missions, game.draw);
      autoRevealing = false;

      drawn.forEach((n, i) => {
        const el = createCard();
        el.style.opacity = 0; el.style.transform = 'translateY(10px)';
        el.addEventListener('click', () => revealCardAt(i));
        cardsEl.appendChild(el);
        setTimeout(()=>{
          el.style.transition = 'transform .5s ease, opacity .5s ease';
          el.style.opacity = 1; el.style.transform = 'translateY(0)';
        }, 160*i);
      });


      const deck = document.getElementById('deckStack');
      deck.animate([
        { transform:'translateY(0) rotate(0deg)' },
        { transform:'translateY(2px) rotate(1deg)' },
        { transform:'translateY(-2px) rotate(-1deg)' },
        { transform:'translateY(0) rotate(0deg)' }
      ], { duration: 480, easing:'ease-in-out' });

      showToast(`Ïπ¥ÎìúÎ•º ÏÖîÌîåÌñàÏäµÎãàÎã§! (1Î≤à ÌïÑÏàò, ${game.draw}Ïû•)`);
      revealBtn.disabled = false;
    });

    revealBtn.addEventListener('click', revealInOrder);


    resetBtn.addEventListener('click', () => {
      cardsEl.innerHTML = '';
      drawn = [];
      autoRevealing = false;
      revealBtn.disabled = true;
      showToast('Ï¥àÍ∏∞Ìôî ÏôÑÎ£å');
    });

    activateMode('succubus');
  </script>
</body>
</html>
